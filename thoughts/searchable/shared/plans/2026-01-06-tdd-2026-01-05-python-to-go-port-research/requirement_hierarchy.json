{
  "requirements": [
    {
      "id": "REQ_000",
      "description": "The system must rewrite core Python logic in Go, converting ~35,371 lines of Python code including subprocess management, JSON handling, and CLI parsing to idiomatic Go equivalents",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_000.1",
          "description": "Convert subprocess module usage to os/exec package for external command execution, implementing wrappers for Claude CLI, git, and beads CLI tools with timeout support, output streaming, and error handling",
          "type": "sub_process",
          "parent_id": "REQ_000",
          "children": [],
          "acceptance_criteria": [
            "Execute external commands (claude, git, bd) with configurable timeout using context.WithTimeout",
            "Capture stdout and stderr separately or combined based on use case",
            "Support working directory specification via cmd.Dir for project-scoped operations",
            "Implement streaming output reading using bufio.Scanner for long-running commands",
            "Handle process termination gracefully when context is cancelled",
            "Return structured CommandResult with Success bool, Output string, Error string, and ExitCode int",
            "Support environment variable injection via cmd.Env for Claude CLI configuration",
            "Implement retry logic with exponential backoff for transient failures",
            "Log command execution with sanitized arguments (hide sensitive data)",
            "Support both synchronous execution (CombinedOutput) and async execution (goroutines with channels)"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create SubprocessRunner struct with default timeout, working directory, and environment settings",
              "Implement Execute(ctx context.Context, name string, args ...string) (*CommandResult, error)",
              "Implement ExecuteWithStdin(ctx context.Context, input string, name string, args ...string) (*CommandResult, error)",
              "Create ClaudeRunner wrapper: RunClaudeCode(projectPath, prompt, model string) (*CommandResult, error)",
              "Create GitRunner wrapper: RunGitCommand(projectPath string, args ...string) (*CommandResult, error)",
              "Create BeadsRunner wrapper: RunBeadsCommand(args ...string) (*CommandResult, error)",
              "Implement StreamingExecute(ctx context.Context, outputChan chan<- string, name string, args ...string) error",
              "Add timeout configuration: default 1 hour for Claude, 30 seconds for git, 60 seconds for beads"
            ],
            "middleware": [
              "Implement command sanitization to remove sensitive environment variables from logs",
              "Add rate limiting for external command execution to prevent resource exhaustion"
            ],
            "shared": [
              "Define CommandResult struct: {Success bool, Output string, Error string, ExitCode int, Duration time.Duration}",
              "Define SubprocessConfig struct: {Timeout time.Duration, WorkDir string, Env map[string]string}",
              "Create error types: ErrCommandTimeout, ErrCommandFailed, ErrCommandNotFound",
              "Define constants for default timeouts: DefaultClaudeTimeout = 1 * time.Hour, DefaultGitTimeout = 30 * time.Second"
            ]
          },
          "testable_properties": [],
          "function_id": "runner.SubprocessRunner.Execute",
          "related_concepts": [
            "os/exec",
            "context.WithTimeout",
            "exec.CommandContext",
            "CombinedOutput",
            "stdout/stderr pipes",
            "process termination",
            "goroutine-based streaming"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_000.2",
          "description": "Convert json module to encoding/json for JSON parsing and serialization, implementing marshaling/unmarshaling for all data models including Feature, FeatureList, RequirementNode, RequirementHierarchy, and checkpoint structures",
          "type": "sub_process",
          "parent_id": "REQ_000",
          "children": [],
          "acceptance_criteria": [
            "Define all struct types with proper json struct tags matching Python field names (snake_case)",
            "Use pointer types for optional fields with omitempty tag to exclude null values",
            "Implement custom MarshalJSON/UnmarshalJSON for complex types like RequirementNode with validation",
            "Support JSON streaming for large files using json.Decoder with Token() method",
            "Handle null values in JSON by using pointer types (*string, *int) for optional fields",
            "Implement pretty-printing with json.MarshalIndent for human-readable output",
            "Parse JSON files from disk using os.ReadFile + json.Unmarshal pattern",
            "Write JSON files atomically using temp file + rename pattern to prevent corruption",
            "Support parsing JSON embedded in Claude CLI text output (extract JSON from mixed content)",
            "Validate JSON schema compatibility with existing Python-generated files"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create JSONFileReader: ReadJSON[T any](path string) (*T, error) generic function",
              "Create JSONFileWriter: WriteJSON(path string, data interface{}, pretty bool) error with atomic write",
              "Implement ExtractJSONFromText(text string) ([]byte, error) for parsing Claude output",
              "Create ValidateJSONSchema(data []byte, schemaPath string) error for schema validation",
              "Implement StreamingJSONDecoder for parsing large feature list files incrementally"
            ],
            "middleware": [
              "Add JSON validation middleware to verify required fields before processing",
              "Implement JSON sanitization to remove sensitive data before logging"
            ],
            "shared": [
              "Define Feature struct: {ID, Name, Description, Category string; Priority int; Passes, Blocked, NeedsReview bool; BlockedReason string; BlockedBy, Dependencies, Tests []string; Complexity string}",
              "Define FeatureList struct: {Features []Feature; Metadata *FeatureListMetadata}",
              "Define RequirementNode struct matching Python dataclass with nested Children []RequirementNode",
              "Define RequirementHierarchy struct with tree traversal methods",
              "Define SessionState struct for checkpoint persistence",
              "Define ImplementationComponents struct: {Functions []Function; Types []Type; Tests []Test}",
              "Define TestableProperty struct: {PropertyName, Description, TestStrategy string; InputDomain, Invariants []string}",
              "Create json_utils.go with helper functions: PrettyPrint, CompactPrint, DeepEqual for JSON comparison"
            ]
          },
          "testable_properties": [],
          "function_id": "models.JSONCodec.Marshal",
          "related_concepts": [
            "encoding/json",
            "json.Marshal",
            "json.Unmarshal",
            "struct tags",
            "json.RawMessage",
            "custom MarshalJSON",
            "omitempty",
            "json.Decoder",
            "streaming JSON"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_000.3",
          "description": "Convert pathlib.Path operations to path/filepath package for cross-platform file system operations including path joining, resolution, existence checking, and directory traversal",
          "type": "sub_process",
          "parent_id": "REQ_000",
          "children": [],
          "acceptance_criteria": [
            "Implement path joining using filepath.Join for cross-platform compatibility (handles / vs \\)",
            "Convert absolute path resolution using filepath.Abs with error handling",
            "Implement file/directory existence checking using os.Stat with proper error type checking",
            "Support glob pattern matching using filepath.Glob for file discovery",
            "Implement recursive directory walking using filepath.WalkDir for project scanning",
            "Create directory trees using os.MkdirAll with configurable permissions (0755 default)",
            "Implement path cleaning using filepath.Clean to normalize paths",
            "Support home directory expansion (~/) using os.UserHomeDir",
            "Handle symbolic links appropriately using filepath.EvalSymlinks when needed",
            "Implement relative path calculation using filepath.Rel for display purposes"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create PathResolver struct with base directory and methods for common operations",
              "Implement Exists(path string) bool using os.Stat with IsNotExist check",
              "Implement IsDir(path string) bool using os.Stat and FileInfo.IsDir()",
              "Implement IsFile(path string) bool using os.Stat and !FileInfo.IsDir()",
              "Implement EnsureDir(path string, perm os.FileMode) error using os.MkdirAll",
              "Implement FindFiles(pattern string) ([]string, error) using filepath.Glob",
              "Implement WalkProject(root string, fn filepath.WalkDirFunc) error for project traversal",
              "Implement ExpandPath(path string) (string, error) for ~ expansion and absolute resolution",
              "Create ProjectPath struct with methods: Join(...string), Parent(), Name(), Exists(), ReadFile(), WriteFile()"
            ],
            "middleware": [
              "Implement path sanitization to prevent directory traversal attacks",
              "Add path validation to ensure paths stay within allowed project directories"
            ],
            "shared": [
              "Define PathConfig struct: {BaseDir string, AllowSymlinks bool, DefaultPerms os.FileMode}",
              "Define common path constants: DefaultProjectDir, DefaultConfigDir, DefaultCacheDir",
              "Create error types: ErrPathNotFound, ErrPathNotDir, ErrPathNotFile, ErrPathTraversal",
              "Define ProjectPaths struct with standard locations: Root, Config, Cache, Output, Thoughts, Plans"
            ]
          },
          "testable_properties": [],
          "function_id": "filesystem.PathResolver.Resolve",
          "related_concepts": [
            "path/filepath",
            "filepath.Join",
            "filepath.Abs",
            "filepath.Walk",
            "filepath.Glob",
            "os.Stat",
            "os.MkdirAll",
            "os.ReadDir",
            "filepath.Clean"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_000.4",
          "description": "Convert Python dataclasses to Go structs with validation methods, implementing post-initialization validation, default values, and JSON serialization for all core data models",
          "type": "sub_process",
          "parent_id": "REQ_000",
          "children": [],
          "acceptance_criteria": [
            "Convert all Python @dataclass definitions to Go structs with exported fields",
            "Implement Validate() error method on each struct for post-construction validation",
            "Create NewXxx() constructor functions that apply defaults and run validation",
            "Use pointer types for optional fields that have meaningful nil states",
            "Implement String() method for human-readable representation (debugging)",
            "Use embedded structs for common field patterns (timestamps, metadata)",
            "Implement Validatable interface: type Validatable interface { Validate() error }",
            "Support field-level validation with descriptive error messages",
            "Implement custom type for enums using const + iota pattern with validation",
            "Create DeepCopy() methods for structs that need cloning"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Implement NewRequirementNode(id, description, nodeType string) (*RequirementNode, error) with validation",
              "Implement NewFeature(id, name, description string) (*Feature, error) with defaults",
              "Implement NewFeatureList(features []Feature) (*FeatureList, error) with duplicate ID detection",
              "Create RequirementHierarchy.Validate() checking tree consistency and ID uniqueness",
              "Implement RequirementNode.AddChild(child *RequirementNode) error with parent ID update",
              "Create Feature.MarkCompleted() and Feature.MarkBlocked(reason string, blockedBy []string)",
              "Implement hierarchy traversal: Walk(fn func(*RequirementNode) error) error",
              "Create RequirementHierarchy.FindByID(id string) *RequirementNode for tree lookup"
            ],
            "middleware": [],
            "shared": [
              "Define RequirementType enum: const (Parent RequirementType = \"parent\"; SubProcess = \"sub_process\"; Implementation = \"implementation\")",
              "Define FeatureComplexity enum: const (Simple Complexity = \"simple\"; Moderate = \"moderate\"; Complex = \"complex\")",
              "Define StepStatus enum: const (Pending Status = \"pending\"; InProgress = \"in_progress\"; Completed = \"completed\"; Failed = \"failed\")",
              "Create validation error types: ErrInvalidID, ErrInvalidType, ErrMissingRequired, ErrDuplicateID",
              "Define Validatable interface in shared package for consistent validation contract",
              "Create BaseModel struct with common fields: CreatedAt, UpdatedAt time.Time; Version int",
              "Define RequirementNode struct with all fields from Python dataclass plus Validate() method",
              "Define ImplementationComponents struct: Functions, Types, Tests slices with nested structs"
            ]
          },
          "testable_properties": [],
          "function_id": "models.StructValidator.Validate",
          "related_concepts": [
            "Go structs",
            "struct tags",
            "validation methods",
            "constructor functions",
            "interface implementation",
            "embedded structs",
            "pointer receivers"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_000.5",
          "description": "Convert asyncio patterns to goroutines and channels for concurrent execution of pipeline steps, Claude sessions, and background tasks with proper synchronization and cancellation support",
          "type": "sub_process",
          "parent_id": "REQ_000",
          "children": [],
          "acceptance_criteria": [
            "Convert async def functions to goroutines with channel-based communication",
            "Implement context.Context propagation for cancellation support throughout the call chain",
            "Use sync.WaitGroup for coordinating multiple concurrent operations",
            "Implement errgroup.Group for concurrent tasks that need first-error collection",
            "Create buffered channels for producer-consumer patterns (streaming output)",
            "Use select statement for multiplexing channel operations and timeout handling",
            "Implement proper goroutine cleanup to prevent leaks on cancellation",
            "Use sync.Mutex for protecting shared state in concurrent contexts",
            "Implement rate limiting using time.Ticker for API call pacing",
            "Support graceful shutdown with signal handling (SIGINT, SIGTERM)"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create TaskRunner struct with context, cancellation, and worker pool management",
              "Implement RunConcurrent(ctx context.Context, tasks []Task) ([]Result, error) using errgroup",
              "Implement StreamOutput(ctx context.Context, cmd *exec.Cmd, outputChan chan<- string) error",
              "Create PipelineRunner with sequential step execution and parallel sub-task support",
              "Implement LoopRunner.RunAutonomous(ctx context.Context) error with continuous execution",
              "Create WorkerPool struct for managing fixed number of concurrent Claude sessions",
              "Implement CheckpointManager.AutoSave(ctx context.Context, interval time.Duration) using time.Ticker",
              "Create SignalHandler for graceful shutdown on SIGINT/SIGTERM",
              "Implement ProgressReporter goroutine for real-time status updates to terminal"
            ],
            "middleware": [
              "Implement RateLimiter middleware using time.Ticker for Claude API pacing",
              "Add circuit breaker pattern for handling repeated failures gracefully"
            ],
            "shared": [
              "Define Task interface: type Task interface { Run(ctx context.Context) error; Name() string }",
              "Define Result struct: {TaskName string; Success bool; Output interface{}; Error error; Duration time.Duration}",
              "Create channel types: type OutputChannel chan string; type ErrorChannel chan error; type DoneChannel chan struct{}",
              "Define WorkerConfig struct: {MaxWorkers int; QueueSize int; Timeout time.Duration}",
              "Create async_utils.go with helpers: WaitWithTimeout, FirstError, CollectResults",
              "Define CancellableTask interface extending Task with Cancel() method",
              "Create constants: DefaultWorkerCount = 4, DefaultQueueSize = 100, DefaultShutdownTimeout = 30 * time.Second"
            ]
          },
          "testable_properties": [],
          "function_id": "async.TaskRunner.RunConcurrent",
          "related_concepts": [
            "goroutines",
            "channels",
            "sync.WaitGroup",
            "context.Context",
            "select statement",
            "sync.Mutex",
            "errgroup",
            "channel buffering",
            "context cancellation"
          ],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    },
    {
      "id": "REQ_001",
      "description": "The system must replace Python CLI framework patterns with Go equivalents, converting argparse-based CLI tools to cobra-based commands with identical functionality",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_001.1",
          "description": "Port orchestrator.py CLI arguments including --project, --new, --model, --max-sessions, --continue, --status, --mcp-preset, --with-qa, and --debug flags to cobra command structure",
          "type": "sub_process",
          "parent_id": "REQ_001",
          "children": [],
          "acceptance_criteria": [
            "Implement --project/-p flag accepting filesystem path to continue existing project",
            "Implement --new flag accepting filesystem path for creating new project",
            "Implement --model/-m flag with default value 'sonnet' and valid choices (sonnet/opus)",
            "Implement --max-sessions flag with int type and default value 100",
            "Implement --continue/-c boolean flag for continuing existing project",
            "Implement --status/-s boolean flag to show status and exit",
            "Implement --mcp-preset flag with valid choices (rust/python/node/docs)",
            "Implement --with-qa boolean flag for generating E2E QA features",
            "Implement --debug/-d boolean flag for debug output",
            "All flags must produce identical help text to Python argparse version",
            "Mutually exclusive flag combinations (--project vs --new) must be validated",
            "Path flags must validate that paths exist when required",
            "Unit tests verify all flag combinations work correctly",
            "Help output matches format: 'context-engine [flags]' with description 'Context-Engineered Agent Orchestrator'"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create cmd/orchestrator/main.go with cobra rootCmd",
              "Define OrchestratorConfig struct with all flag fields (ProjectPath, NewPath, Model, MaxSessions, ContinueFlag, StatusFlag, McpPreset, WithQA, Debug)",
              "Implement init() function registering all flags with cobra",
              "Implement runOrchestrator(cmd *cobra.Command, args []string) function",
              "Create internal/app/orchestrator.go with core orchestrator logic accepting OrchestratorConfig"
            ],
            "middleware": [
              "Implement PreRunE validation hook for mutually exclusive flags",
              "Implement path existence validation for --project flag",
              "Implement enum validation for --model choices (sonnet/opus)",
              "Implement enum validation for --mcp-preset choices (rust/python/node/docs)"
            ],
            "shared": [
              "Define ModelType enum using const + iota (ModelSonnet, ModelOpus)",
              "Define McpPreset enum using const + iota (PresetRust, PresetPython, PresetNode, PresetDocs)",
              "Create internal/cli/validation.go with ValidatePath, ValidateEnum helper functions",
              "Create internal/models/config.go with OrchestratorConfig struct"
            ]
          },
          "testable_properties": [],
          "function_id": "cmd.orchestrator.InitFlags",
          "related_concepts": [
            "cobra",
            "pflag",
            "CLI argument parsing",
            "Go structs",
            "flag validation"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_001.2",
          "description": "Port loop-runner.py CLI arguments to cobra command structure maintaining feature list processing, dependency resolution, and session management functionality",
          "type": "sub_process",
          "parent_id": "REQ_001",
          "children": [],
          "acceptance_criteria": [
            "Implement --features/-f flag accepting path to features.json file",
            "Implement --project/-p flag accepting filesystem path to project directory",
            "Implement --model/-m flag with default value 'sonnet' and valid choices",
            "Implement --max-iterations flag with int type for maximum loop iterations",
            "Implement --timeout flag with duration type for session timeout",
            "Implement --parallel/-P flag with int type for parallel execution count",
            "Implement --dry-run boolean flag for validation without execution",
            "Implement --resume boolean flag to resume from last checkpoint",
            "Implement --verbose/-v boolean flag for verbose output",
            "Help text describes loop-runner as 'Autonomous loop runner that continuously runs Claude Code sessions'",
            "Features.json path must be validated for existence and valid JSON schema",
            "Unit tests verify feature list loading and validation",
            "Integration tests verify topological sort of feature dependencies works correctly"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create cmd/loop-runner/main.go with cobra rootCmd",
              "Define LoopRunnerConfig struct with all flag fields",
              "Implement init() function registering all flags",
              "Implement runLoopRunner(cmd *cobra.Command, args []string) function",
              "Create internal/app/loop_runner.go with core loop logic",
              "Port topological sort algorithm from loop-runner.py:154-209 to Go",
              "Port complexity detection algorithm from loop-runner.py:348-405 to Go",
              "Port feature list validation from loop-runner.py:40-106 to Go"
            ],
            "middleware": [
              "Implement features.json schema validation using JSON schema or custom validators",
              "Implement PreRunE validation for required flags",
              "Implement checkpoint recovery validation when --resume is set"
            ],
            "shared": [
              "Define Feature struct matching JSON schema (ID, Name, Description, Priority, Category, Passes, Blocked, BlockedReason, BlockedBy, Dependencies, Tests, Complexity, NeedsReview)",
              "Define FeatureList struct with Features []Feature field",
              "Create internal/models/feature.go with Feature and FeatureList structs",
              "Create pkg/features/loader.go with LoadFeatureList(path string) function",
              "Create pkg/features/validator.go with ValidateFeatureList function",
              "Create internal/pipeline/topological.go with TopologicalSort function"
            ]
          },
          "testable_properties": [],
          "function_id": "cmd.looprunner.InitFlags",
          "related_concepts": [
            "cobra",
            "feature list JSON",
            "topological sort",
            "complexity detection",
            "session tracking"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_001.3",
          "description": "Implement flag validation and help text matching current Python behavior with consistent error messages and usage patterns",
          "type": "sub_process",
          "parent_id": "REQ_001",
          "children": [],
          "acceptance_criteria": [
            "All required flags produce 'required flag not set' error with flag name",
            "Invalid enum values produce 'invalid value for --flag: must be one of [choices]' error",
            "Invalid path values produce 'path does not exist: <path>' error",
            "Invalid integer values produce 'invalid integer value for --flag' error",
            "Help text (-h/--help) displays formatted usage with all flags and descriptions",
            "Version flag (--version) displays binary version from build-time injection",
            "Error messages match Python argparse style for user familiarity",
            "Custom usage template matches Python argparse output format",
            "All validation errors are wrapped with context using fmt.Errorf or errors package",
            "Unit tests cover all validation error paths",
            "Validation functions are reusable across all CLI commands"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create internal/cli/validation.go with centralized validation functions",
              "Implement ValidatePathExists(path string) error function",
              "Implement ValidatePathIsDirectory(path string) error function",
              "Implement ValidateEnum(value string, choices []string, flagName string) error function",
              "Implement ValidatePositiveInt(value int, flagName string) error function",
              "Implement ValidateDuration(value time.Duration, min, max time.Duration) error function"
            ],
            "middleware": [
              "Create internal/cli/errors.go with custom error types (ValidationError, PathError, EnumError)",
              "Implement Error() method for each custom error type",
              "Implement Is() method for error matching",
              "Create centralized error handler that formats errors consistently"
            ],
            "shared": [
              "Create internal/cli/usage.go with custom usage template matching Python argparse style",
              "Create internal/cli/help.go with formatted help text generator",
              "Define ValidationResult struct for collecting multiple validation errors",
              "Create internal/cli/colors.go porting Colors class from orchestrator.py:148-166"
            ]
          },
          "testable_properties": [],
          "function_id": "cmd.common.FlagValidation",
          "related_concepts": [
            "cobra validation",
            "pflag",
            "error handling",
            "usage templates",
            "Go error wrapping"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_001.4",
          "description": "Support short and long flag forms (e.g., -p and --project) with cobra pflag integration ensuring all flag aliases work correctly",
          "type": "sub_process",
          "parent_id": "REQ_001",
          "children": [],
          "acceptance_criteria": [
            "-p is alias for --project in orchestrator command",
            "-m is alias for --model in both orchestrator and loop-runner",
            "-c is alias for --continue in orchestrator command",
            "-s is alias for --status in orchestrator command",
            "-d is alias for --debug in orchestrator command",
            "-f is alias for --features in loop-runner command",
            "-P is alias for --parallel in loop-runner command",
            "-v is alias for --verbose in loop-runner command",
            "Both short and long forms appear in help text",
            "Short flags can be combined (e.g., -cd for --continue --debug)",
            "Unit tests verify short and long flag equivalence",
            "Help text format shows '-p, --project string' style"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Use cobra StringVarP for string flags with short aliases",
              "Use cobra BoolVarP for boolean flags with short aliases",
              "Use cobra IntVarP for integer flags with short aliases",
              "Implement consistent flag naming convention across all commands",
              "Create flag registration helper functions for common patterns"
            ],
            "middleware": [
              "Ensure pflag handles combined short flags correctly",
              "Implement flag conflict detection for duplicate short flags across commands"
            ],
            "shared": [
              "Create internal/cli/flags.go with RegisterStringFlag, RegisterBoolFlag, RegisterIntFlag helpers",
              "Define FlagDef struct with Name, Short, Default, Description, Required fields",
              "Create flag registration from FlagDef slice for consistent patterns"
            ]
          },
          "testable_properties": [],
          "function_id": "cmd.common.ShortLongFlags",
          "related_concepts": [
            "pflag",
            "cobra aliases",
            "POSIX flag conventions",
            "GNU flag conventions"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_001.5",
          "description": "Implement subcommands for planning_orchestrator, mcp-setup, resume_planning, and resume_pipeline entry points as cobra subcommands under a unified CLI",
          "type": "sub_process",
          "parent_id": "REQ_001",
          "children": [],
          "acceptance_criteria": [
            "Main binary 'context-engine' supports subcommands: plan, mcp-setup, resume",
            "'context-engine plan' maps to planning_orchestrator.py functionality (596 lines)",
            "'context-engine mcp-setup' maps to mcp-setup.py functionality (634 lines)",
            "'context-engine resume planning' maps to resume_planning.py (23 lines)",
            "'context-engine resume pipeline' maps to resume_pipeline.py (175 lines)",
            "Each subcommand has own flags inheriting from parent where appropriate",
            "Global flags (--debug, --verbose) available to all subcommands",
            "Help text for 'context-engine --help' lists all available subcommands",
            "Help text for 'context-engine plan --help' shows plan-specific flags",
            "Subcommand aliases supported (e.g., 'context-engine p' for 'context-engine plan')",
            "Unknown subcommand produces helpful error with suggestions",
            "Tab completion support for subcommands in bash/zsh"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create cmd/context-engine/main.go as unified entry point",
              "Create cmd/context-engine/plan.go with planCmd subcommand",
              "Create cmd/context-engine/mcp_setup.go with mcpSetupCmd subcommand",
              "Create cmd/context-engine/resume.go with resumeCmd parent subcommand",
              "Create cmd/context-engine/resume_planning.go with resumePlanningCmd nested subcommand",
              "Create cmd/context-engine/resume_pipeline.go with resumePipelineCmd nested subcommand",
              "Implement AddCommand() calls in root.go to register all subcommands",
              "Port planning_orchestrator.py logic to internal/app/planning_orchestrator.go",
              "Port mcp-setup.py logic to internal/app/mcp_setup.go",
              "Port resume_planning.py logic to internal/app/resume_planning.go",
              "Port resume_pipeline.py logic to internal/app/resume_pipeline.go"
            ],
            "middleware": [
              "Implement PersistentPreRunE on root command for global flag processing",
              "Implement global --debug flag using PersistentFlags()",
              "Implement global --verbose flag using PersistentFlags()",
              "Create middleware to set up logging based on global flags"
            ],
            "shared": [
              "Define GlobalConfig struct with Debug, Verbose fields",
              "Create internal/cli/root.go with shared root command configuration",
              "Create internal/cli/completion.go with bash/zsh completion generation",
              "Define command aliases in shared constants file",
              "Create internal/cli/suggestions.go with subcommand suggestion algorithm for typos"
            ]
          },
          "testable_properties": [],
          "function_id": "cmd.subcommands.InitSubcommands",
          "related_concepts": [
            "cobra subcommands",
            "CLI hierarchy",
            "command composition",
            "shared flags"
          ],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    },
    {
      "id": "REQ_002",
      "description": "The system must maintain external integrations with Claude CLI, git, and beads CLI tools via os/exec subprocess calls with proper timeout handling and output capture",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_002.1",
          "description": "Implement Claude CLI wrapper supporting --print, --model, --permission-mode, and --output-format flags with streaming output support",
          "type": "sub_process",
          "parent_id": "REQ_002",
          "children": [],
          "acceptance_criteria": [
            "ClaudeRunner struct accepts model (sonnet/opus), timeout, outputFormat (text/stream-json), and working directory",
            "Execute method constructs 'claude --print --model <model> --permission-mode bypassPermissions --output-format <format> <prompt>' command",
            "Streaming output pipes stdout to terminal in real-time using bufio.Scanner",
            "stream-json format emits JSON events compatible with npx repomirror visualize",
            "Returns CommandResult struct with Success, Output, Error, Elapsed, and ReturnCode fields",
            "Handles TimeoutExpired by returning structured error result without crashing",
            "Supports optional PTY wrapper via os/exec and script command for real-time streaming",
            "CLAUDE_CODE_MAX_OUTPUT_TOKENS environment variable defaults to 128000",
            "Formats tool calls with ANSI colors for human-readable output mode"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create internal/runner/claude.go with ClaudeRunner struct",
              "Implement ClaudeConfig struct with Model, Timeout, OutputFormat, WorkingDir fields",
              "Implement Execute(prompt string) (*CommandResult, error) method",
              "Implement ExecuteStreaming(prompt string, writer io.Writer) (*CommandResult, error) for real-time output",
              "Create parseStreamJSON helper to extract text from stream-json events",
              "Implement formatToolCall(name string, input map[string]interface{}) for colored output"
            ],
            "middleware": [
              "Add environment variable validation for CLAUDE_CODE_MAX_OUTPUT_TOKENS"
            ],
            "shared": [
              "Create internal/models/command_result.go with CommandResult struct",
              "Create internal/runner/colors.go with ANSI color constants (RESET, BOLD, DIM, RED, GREEN, YELLOW, BLUE, MAGENTA, CYAN)",
              "Create OutputFormat type alias as string enum ('text', 'stream-json')"
            ]
          },
          "testable_properties": [],
          "function_id": "runner.ClaudeRunner.Execute",
          "related_concepts": [
            "subprocess management",
            "CLI flag parsing",
            "streaming output",
            "timeout handling",
            "JSON/text output formats",
            "PTY wrapper for real-time streaming"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_002.2",
          "description": "Implement context.WithTimeout for command execution with configurable timeout (default 1 hour for Claude calls)",
          "type": "sub_process",
          "parent_id": "REQ_002",
          "children": [],
          "acceptance_criteria": [
            "All subprocess calls use context.WithTimeout with configurable duration",
            "Default timeout for Claude CLI calls is 1 hour (3600 seconds) matching Python SESSION_TIMEOUT",
            "Default timeout for beads CLI calls is 30 seconds",
            "Default timeout for git CLI calls is 60 seconds",
            "Timeout cancellation properly kills child process and all descendants",
            "TimeoutError is distinguishable from other errors via error type assertion",
            "Elapsed time is tracked accurately regardless of timeout or success",
            "Context cancellation is propagated through goroutines for streaming operations",
            "Partial output is captured and returned even when timeout occurs"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create internal/runner/subprocess.go with RunWithTimeout function",
              "Implement RunCommandContext(ctx context.Context, cmd *exec.Cmd) (*CommandResult, error)",
              "Add process group management for proper child process cleanup on timeout",
              "Implement timeout error wrapping: type TimeoutError struct { Duration time.Duration; PartialOutput string }",
              "Create configurable timeout constants: ClaudeTimeout = 1*time.Hour, BeadsTimeout = 30*time.Second, GitTimeout = 60*time.Second"
            ],
            "middleware": [],
            "shared": [
              "Create internal/runner/config.go with timeout configuration defaults",
              "Add TimeoutConfig struct with fields for each CLI tool type"
            ]
          },
          "testable_properties": [],
          "function_id": "runner.WithTimeout",
          "related_concepts": [
            "context.Context",
            "context.WithTimeout",
            "goroutines",
            "channels",
            "deadline propagation",
            "graceful termination"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_002.3",
          "description": "Implement git subprocess calls for version control operations including init, add, commit, config, status, and diff",
          "type": "sub_process",
          "parent_id": "REQ_002",
          "children": [],
          "acceptance_criteria": [
            "GitRunner struct wraps os/exec for git CLI operations",
            "Init(path string) error initializes new git repository at path",
            "Add(paths ...string) error stages files with 'git add' (supports -A flag for all)",
            "Commit(message string) error creates commit with 'git commit -m'",
            "Config(key, value string) error sets git config locally",
            "Status() (string, error) returns current working tree status",
            "Diff(staged bool) (string, error) returns diff output (--staged flag optional)",
            "GetHeadCommit() (string, error) returns current HEAD commit hash",
            "All operations capture stdout and stderr separately",
            "Working directory (cwd) is configurable per GitRunner instance",
            "60 second default timeout for all git operations"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create internal/runner/git.go with GitRunner struct",
              "Implement NewGitRunner(workDir string) *GitRunner constructor",
              "Implement Init() error for 'git init'",
              "Implement Add(paths ...string) error for 'git add'",
              "Implement AddAll() error for 'git add -A'",
              "Implement Commit(message string) error for 'git commit -m'",
              "Implement Config(key, value string) error for 'git config'",
              "Implement Status() (*GitStatus, error) with parsed status info",
              "Implement Diff(staged bool) (string, error) for git diff",
              "Implement GetHeadCommit() (string, error) using 'git rev-parse HEAD'"
            ],
            "middleware": [],
            "shared": [
              "Create internal/models/git_status.go with GitStatus struct (ModifiedFiles, UntrackedFiles, StagedFiles slices)",
              "Add git error types: ErrNotRepository, ErrNothingToCommit, ErrConflict"
            ]
          },
          "testable_properties": [],
          "function_id": "runner.GitRunner.Execute",
          "related_concepts": [
            "version control",
            "subprocess management",
            "working directory",
            "git operations",
            "atomic commits"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_002.4",
          "description": "Implement beads (bd) CLI wrapper for issue tracking operations with JSON output support",
          "type": "sub_process",
          "parent_id": "REQ_002",
          "children": [],
          "acceptance_criteria": [
            "BeadsController struct wraps 'bd' CLI with project_path configuration",
            "All operations support --json flag for structured JSON output",
            "CreateIssue(title, issueType, priority) returns created issue data",
            "CreateEpic(title, priority) is convenience wrapper for epic creation",
            "ListIssues(status filter) returns list of issues as []Issue struct",
            "CloseIssue(issueId, reason) closes issue with optional reason",
            "AddDependency(issueId, dependsOn) adds dependency relationship",
            "Sync() syncs beads with git remote (does not use --json)",
            "GetReadyIssue(limit) returns issues with no blockers",
            "UpdateStatus(issueId, status) updates issue status",
            "ShowIssue(issueId) returns full issue details as Issue struct",
            "30 second default timeout for all beads operations",
            "Handles 'bd command not found' error gracefully with descriptive message",
            "JSON parse errors return raw stdout as fallback"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create pkg/beads/client.go with BeadsController struct (public API)",
              "Implement NewBeadsController(projectPath string) *BeadsController constructor",
              "Implement private runBd(args []string, useJSON bool) (*CommandResult, error) helper",
              "Implement CreateIssue(title string, issueType string, priority int) (*Issue, error)",
              "Implement CreateEpic(title string, priority int) (*Issue, error)",
              "Implement ListIssues(status string) ([]Issue, error)",
              "Implement CloseIssue(issueId string, reason string) error",
              "Implement AddDependency(issueId string, dependsOn string) error",
              "Implement Sync() error (no JSON output)",
              "Implement GetReadyIssue(limit int) ([]Issue, error)",
              "Implement UpdateStatus(issueId string, status string) error",
              "Implement ShowIssue(issueId string) (*Issue, error)"
            ],
            "middleware": [],
            "shared": [
              "Create pkg/beads/models.go with Issue struct (ID, Title, Type, Priority, Status, Dependencies, BlockedBy)",
              "Create pkg/beads/errors.go with ErrBeadsNotInstalled, ErrIssueNotFound error types",
              "Create BeadsResult struct with Success bool, Data interface{}, Error string"
            ]
          },
          "testable_properties": [],
          "function_id": "pkg.beads.BeadsController",
          "related_concepts": [
            "issue tracking",
            "JSON parsing",
            "CLI wrapper",
            "subprocess management",
            "structured output"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_002.5",
          "description": "Support build tool integrations: cargo, npm, pytest, go test, make with automatic detection",
          "type": "sub_process",
          "parent_id": "REQ_002",
          "children": [],
          "acceptance_criteria": [
            "BuildToolRunner detects project type from marker files (Cargo.toml, package.json, go.mod, requirements.txt, pyproject.toml, Makefile)",
            "DetectTestCommand(projectPath) returns appropriate test command string or empty if unknown",
            "Cargo projects return 'cargo test'",
            "Node.js projects return 'npm test'",
            "Go projects return 'go test ./...'",
            "Python projects return 'pytest'",
            "Makefile projects return 'make test'",
            "RunTests(projectPath) executes detected test command with output capture",
            "RunBuild(projectPath) executes appropriate build command (cargo build, npm run build, go build, make)",
            "Configurable timeout per tool type (default 5 minutes for tests, 10 minutes for builds)",
            "Returns structured result with pass/fail status, output, and elapsed time",
            "Supports running arbitrary commands via RunCommand(projectPath, command) for flexibility"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Create internal/runner/build_tools.go with BuildToolRunner struct",
              "Implement NewBuildToolRunner(workDir string) *BuildToolRunner constructor",
              "Implement DetectProjectType() ProjectType enum (Rust, Node, Go, Python, Make, Unknown)",
              "Implement DetectTestCommand() string based on marker file detection",
              "Implement DetectBuildCommand() string based on project type",
              "Implement RunTests() (*TestResult, error) using detected test command",
              "Implement RunBuild() (*BuildResult, error) using detected build command",
              "Implement RunCommand(command string, args ...string) (*CommandResult, error) for arbitrary commands",
              "Add marker file detection: checkFileExists for Cargo.toml, package.json, go.mod, requirements.txt, pyproject.toml, Makefile"
            ],
            "middleware": [],
            "shared": [
              "Create internal/models/project_type.go with ProjectType enum and String() method",
              "Create internal/models/test_result.go with TestResult struct (Passed bool, Total int, Failed int, Output string, Elapsed time.Duration)",
              "Create internal/models/build_result.go with BuildResult struct (Success bool, Output string, Artifacts []string, Elapsed time.Duration)",
              "Create internal/runner/marker_files.go with MarkerFileMapping map[ProjectType]string"
            ]
          },
          "testable_properties": [],
          "function_id": "runner.BuildToolRunner.Execute",
          "related_concepts": [
            "build tools",
            "test runners",
            "project detection",
            "polyglot support",
            "command execution"
          ],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    },
    {
      "id": "REQ_003",
      "description": "The system must support cross-compilation to build static binaries for multiple target platforms without requiring special toolchains",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_003.1",
          "description": "Build static binary for macOS Intel (x86-64) architecture using CGO_ENABLED=0 GOOS=darwin GOARCH=amd64",
          "type": "sub_process",
          "parent_id": "REQ_003",
          "children": [],
          "acceptance_criteria": [
            "Binary compiles successfully with GOOS=darwin GOARCH=amd64 environment variables",
            "CGO_ENABLED=0 is set to produce fully static binary without C dependencies",
            "Binary is named with platform suffix: context-engine-darwin-amd64",
            "Binary file size is reasonable (< 50MB for typical Go application)",
            "Binary includes embedded version information via -ldflags",
            "Build completes without requiring Xcode or macOS-specific toolchain on Linux/Windows build hosts",
            "File command shows correct architecture: Mach-O 64-bit x86_64 executable",
            "Binary can be verified using 'go tool objdump' to confirm amd64 instructions"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Implement build target in Makefile: build-darwin-amd64",
              "Set CGO_ENABLED=0 to disable C dependencies",
              "Configure GOOS=darwin GOARCH=amd64 environment",
              "Apply LDFLAGS for version embedding: -X main.version=$(VERSION)",
              "Output binary to bin/context-engine-darwin-amd64",
              "Build both orchestrator and loop-runner binaries for this target"
            ],
            "middleware": [
              "Validate Go toolchain version >= 1.21 before build",
              "Check for conflicting CGO requirements in dependencies"
            ],
            "shared": [
              "VERSION variable extracted from git describe --tags --always --dirty",
              "Common LDFLAGS definition reusable across all platforms",
              "Binary naming convention: {binary}-{os}-{arch}"
            ]
          },
          "testable_properties": [],
          "function_id": "CrossCompiler.buildMacOSIntel",
          "related_concepts": [
            "cross-compilation",
            "static linking",
            "darwin platform",
            "x86-64 architecture",
            "CGO disabled builds"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_003.2",
          "description": "Build static binary for macOS Apple Silicon (ARM64) architecture using CGO_ENABLED=0 GOOS=darwin GOARCH=arm64",
          "type": "sub_process",
          "parent_id": "REQ_003",
          "children": [],
          "acceptance_criteria": [
            "Binary compiles successfully with GOOS=darwin GOARCH=arm64 environment variables",
            "CGO_ENABLED=0 is set to produce fully static binary",
            "Binary is named with platform suffix: context-engine-darwin-arm64",
            "Build completes without requiring Apple Silicon hardware or Xcode",
            "File command shows correct architecture: Mach-O 64-bit arm64 executable",
            "Binary includes version information embedded via ldflags",
            "Binary can run natively on M1/M2/M3 Macs without Rosetta translation",
            "No runtime dependency on system libraries beyond kernel"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Implement build target in Makefile: build-darwin-arm64",
              "Set CGO_ENABLED=0 GOOS=darwin GOARCH=arm64",
              "Apply standard LDFLAGS for version embedding",
              "Output binary to bin/context-engine-darwin-arm64",
              "Build loop-runner-darwin-arm64 as secondary binary",
              "Verify arm64 instruction set in generated binary"
            ],
            "middleware": [
              "Ensure no ARM64-incompatible assembly in dependencies",
              "Validate all imported packages support darwin/arm64"
            ],
            "shared": [
              "Unified build script handling both darwin architectures",
              "Platform detection for local vs cross-compilation scenarios",
              "Universal binary option: lipo to combine amd64 and arm64 (optional)"
            ]
          },
          "testable_properties": [],
          "function_id": "CrossCompiler.buildMacOSAppleSilicon",
          "related_concepts": [
            "cross-compilation",
            "ARM64 architecture",
            "Apple Silicon M1/M2/M3",
            "darwin platform",
            "static linking"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_003.3",
          "description": "Build static binary for Linux x86-64 architecture using CGO_ENABLED=0 GOOS=linux GOARCH=amd64 for deployment on standard Linux servers",
          "type": "sub_process",
          "parent_id": "REQ_003",
          "children": [],
          "acceptance_criteria": [
            "Binary compiles successfully with GOOS=linux GOARCH=amd64",
            "CGO_ENABLED=0 produces fully static binary with no glibc dependency",
            "Binary is named: context-engine-linux-amd64",
            "Binary runs on any Linux x86-64 system including Alpine (musl) and Ubuntu (glibc)",
            "File command shows: ELF 64-bit LSB executable, x86-64",
            "ldd command returns 'not a dynamic executable' (fully static)",
            "Binary works inside Docker containers without additional runtime libraries",
            "Build succeeds on macOS and Windows development machines"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Implement build target in Makefile: build-linux-amd64",
              "Set CGO_ENABLED=0 GOOS=linux GOARCH=amd64",
              "Apply LDFLAGS including -extldflags '-static' for extra assurance",
              "Output to bin/context-engine-linux-amd64",
              "Build loop-runner-linux-amd64 as secondary target",
              "Add Docker test stage to verify binary runs in alpine:latest"
            ],
            "middleware": [
              "Verify no net/cgo or os/user with CGO calls in dependency tree",
              "Use pure Go implementations: -tags netgo for DNS resolution"
            ],
            "shared": [
              "Build tags definition: -tags 'netgo osusergo' for pure Go fallbacks",
              "Dockerfile.test for validating Linux binary in container",
              "CI pipeline step for Linux build verification"
            ]
          },
          "testable_properties": [],
          "function_id": "CrossCompiler.buildLinuxAMD64",
          "related_concepts": [
            "cross-compilation",
            "Linux deployment",
            "x86-64 architecture",
            "static ELF binary",
            "container compatibility"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_003.4",
          "description": "Build static binary for Linux ARM64 architecture using CGO_ENABLED=0 GOOS=linux GOARCH=arm64 for Raspberry Pi, AWS Graviton, and ARM servers",
          "type": "sub_process",
          "parent_id": "REQ_003",
          "children": [],
          "acceptance_criteria": [
            "Binary compiles successfully with GOOS=linux GOARCH=arm64",
            "CGO_ENABLED=0 produces fully static binary",
            "Binary is named: context-engine-linux-arm64",
            "Binary runs on Raspberry Pi 4/5 with 64-bit OS",
            "Binary runs on AWS Graviton instances without additional dependencies",
            "File command shows: ELF 64-bit LSB executable, ARM aarch64",
            "Build completes on x86-64 development machines without ARM toolchain",
            "Binary works in arm64 Docker containers (e.g., arm64v8/alpine)"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Implement build target in Makefile: build-linux-arm64",
              "Set CGO_ENABLED=0 GOOS=linux GOARCH=arm64",
              "Apply standard LDFLAGS with version embedding",
              "Output to bin/context-engine-linux-arm64",
              "Build loop-runner-linux-arm64 as secondary target",
              "Add QEMU-based test for ARM64 binary validation in CI"
            ],
            "middleware": [
              "Ensure pure Go implementations for all system calls",
              "Validate arm64 compatibility of all third-party dependencies"
            ],
            "shared": [
              "ARM64 test matrix including Raspberry Pi OS and Ubuntu Server",
              "QEMU user-mode emulation configuration for CI testing",
              "Documentation for ARM64 deployment scenarios"
            ]
          },
          "testable_properties": [],
          "function_id": "CrossCompiler.buildLinuxARM64",
          "related_concepts": [
            "cross-compilation",
            "ARM64 Linux",
            "Raspberry Pi 4/5",
            "AWS Graviton",
            "embedded systems",
            "aarch64"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_003.5",
          "description": "Build static executable for Windows x86-64 using CGO_ENABLED=0 GOOS=windows GOARCH=amd64 with .exe extension",
          "type": "sub_process",
          "parent_id": "REQ_003",
          "children": [],
          "acceptance_criteria": [
            "Binary compiles successfully with GOOS=windows GOARCH=amd64",
            "CGO_ENABLED=0 produces executable without Visual C++ runtime dependency",
            "Binary is named with .exe extension: context-engine-windows-amd64.exe",
            "Executable runs on Windows 10/11 x64 without additional DLLs",
            "File command shows: PE32+ executable (console) x86-64",
            "Windows Defender does not flag binary as suspicious",
            "Build completes on Linux/macOS without MinGW or Windows SDK",
            "Console output displays correctly in cmd.exe and PowerShell"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Implement build target in Makefile: build-windows-amd64",
              "Set CGO_ENABLED=0 GOOS=windows GOARCH=amd64",
              "Apply LDFLAGS for version embedding",
              "Output to bin/context-engine-windows-amd64.exe",
              "Build loop-runner-windows-amd64.exe as secondary target",
              "Handle Windows-specific path separators in embedded paths"
            ],
            "middleware": [
              "Ensure os/exec calls use correct Windows command syntax",
              "Handle Windows path conventions (backslash, drive letters)",
              "Validate subprocess calls work with cmd.exe and PowerShell"
            ],
            "shared": [
              "Windows-compatible path handling utilities",
              "ANSI color code support detection for Windows terminals",
              "Installation script: install.ps1 for Windows users",
              "Documentation for Windows-specific usage (PATH configuration, terminal requirements)"
            ]
          },
          "testable_properties": [],
          "function_id": "CrossCompiler.buildWindowsAMD64",
          "related_concepts": [
            "cross-compilation",
            "Windows executable",
            "PE format",
            "x86-64 Windows",
            "console application"
          ],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    },
    {
      "id": "REQ_004",
      "description": "The system must install compiled Go binaries to /usr/local/bin via Makefile or install script with proper permissions and version embedding",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_004.1",
          "description": "Implement Makefile with build, install, uninstall, and release targets for compiling Go binaries and managing installation lifecycle",
          "type": "sub_process",
          "parent_id": "REQ_004",
          "children": [],
          "acceptance_criteria": [
            "Makefile exists at project root with .PHONY declarations for all targets",
            "build target compiles both context-engine and loop-runner binaries to bin/ directory",
            "install target depends on build and copies binaries to $(PREFIX)/bin (default /usr/local)",
            "uninstall target removes installed binaries from $(PREFIX)/bin",
            "release target builds binaries for darwin/amd64, darwin/arm64, linux/amd64, linux/arm64, windows/amd64",
            "clean target removes bin/ directory and all compiled artifacts",
            "all target is default and runs build",
            "Makefile uses $(BINDIR) = $(PREFIX)/bin pattern for consistent path handling",
            "CGO_ENABLED=0 used for static binary compilation in release target",
            "Makefile includes help target that documents all available targets"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Define BINARY_NAME=context-engine and LOOP_BINARY=loop-runner variables",
              "Define PREFIX ?= /usr/local with override support",
              "Define BINDIR = $(PREFIX)/bin derived variable",
              "Implement build: go build -o bin/$(BINARY_NAME) ./cmd/orchestrator",
              "Implement build: go build -o bin/$(LOOP_BINARY) ./cmd/loop-runner",
              "Implement install: install -d $(BINDIR) && install -m 755 bin/* $(BINDIR)/",
              "Implement uninstall: rm -f $(BINDIR)/$(BINARY_NAME) $(BINDIR)/$(LOOP_BINARY)",
              "Implement release with GOOS/GOARCH matrix for all platforms",
              "Implement clean: rm -rf bin/"
            ],
            "middleware": [
              "Verify go binary exists before build",
              "Check write permissions on $(BINDIR) during install"
            ],
            "shared": [
              "Define consistent naming convention: $(BINARY_NAME)-$(GOOS)-$(GOARCH)",
              "Document required Go version (1.21+) in Makefile comments"
            ]
          },
          "testable_properties": [],
          "function_id": "Makefile.buildTargets",
          "related_concepts": [
            "GNU Make",
            "Go build system",
            "cross-compilation",
            "build automation",
            "release management"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_004.2",
          "description": "Embed version information via ldflags using git describe --tags to compile version, commit, and build date into binary",
          "type": "sub_process",
          "parent_id": "REQ_004",
          "children": [],
          "acceptance_criteria": [
            "VERSION variable captures git describe --tags --always --dirty output",
            "COMMIT variable captures git rev-parse --short HEAD output",
            "BUILD_DATE variable captures current timestamp in ISO 8601 format",
            "LDFLAGS embeds -X main.version=$(VERSION) for version string",
            "LDFLAGS embeds -X main.commit=$(COMMIT) for commit hash",
            "LDFLAGS embeds -X main.buildDate=$(BUILD_DATE) for build timestamp",
            "main.go declares var version, commit, buildDate string at package level",
            "CLI --version flag outputs formatted version info (e.g., 'context-engine v1.2.3 (abc1234) built 2026-01-06')",
            "Version info accessible programmatically for logging and debugging",
            "Dirty tag suffix appears when working directory has uncommitted changes"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Add to Makefile: VERSION ?= $(shell git describe --tags --always --dirty)",
              "Add to Makefile: COMMIT ?= $(shell git rev-parse --short HEAD)",
              "Add to Makefile: BUILD_DATE ?= $(shell date -u +%Y-%m-%dT%H:%M:%SZ)",
              "Construct LDFLAGS = -ldflags \"-X main.version=$(VERSION) -X main.commit=$(COMMIT) -X main.buildDate=$(BUILD_DATE)\"",
              "Apply $(LDFLAGS) to all go build commands",
              "Create cmd/orchestrator/version.go with version variables and Version() function",
              "Create cmd/loop-runner/version.go with version variables and Version() function",
              "Implement --version/-v flag in cobra root command"
            ],
            "middleware": [],
            "shared": [
              "Create internal/version/version.go package for shared version utilities",
              "Define VersionInfo struct with Version, Commit, BuildDate fields",
              "Implement String() method for formatted version output"
            ]
          },
          "testable_properties": [],
          "function_id": "Build.versionEmbedding",
          "related_concepts": [
            "ldflags",
            "git describe",
            "semantic versioning",
            "build metadata",
            "runtime version introspection"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_004.3",
          "description": "Install context-engine binary (orchestrator) to $(PREFIX)/bin with 755 permissions using install command",
          "type": "sub_process",
          "parent_id": "REQ_004",
          "children": [],
          "acceptance_criteria": [
            "Binary installed to $(PREFIX)/bin/context-engine (default: /usr/local/bin/context-engine)",
            "File permissions set to 755 (rwxr-xr-x) via install -m 755",
            "install -d $(BINDIR) creates directory if it doesn't exist",
            "Installation fails gracefully with permission error message if user lacks write access",
            "Binary is executable immediately after installation (no additional chmod needed)",
            "Existing binary is overwritten during reinstall",
            "Post-install message confirms installation path",
            "which context-engine returns correct path after installation",
            "context-engine --version runs successfully after installation"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Makefile target: install-orchestrator: bin/context-engine",
              "Command: install -d $(BINDIR)",
              "Command: install -m 755 bin/context-engine $(BINDIR)/context-engine",
              "Add install-orchestrator as dependency of main install target",
              "Echo installation path on success: @echo 'Installed: $(BINDIR)/context-engine'"
            ],
            "middleware": [
              "Check if $(BINDIR) requires sudo and warn user",
              "Verify binary exists before attempting install"
            ],
            "shared": [
              "Binary name constant: BINARY_NAME=context-engine",
              "Source path: bin/$(BINARY_NAME)"
            ]
          },
          "testable_properties": [],
          "function_id": "Install.contextEngineBinary",
          "related_concepts": [
            "file permissions",
            "install command",
            "sudo elevation",
            "binary installation",
            "PATH configuration"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_004.4",
          "description": "Install loop-runner binary to $(PREFIX)/bin with 755 permissions using install command",
          "type": "sub_process",
          "parent_id": "REQ_004",
          "children": [],
          "acceptance_criteria": [
            "Binary installed to $(PREFIX)/bin/loop-runner (default: /usr/local/bin/loop-runner)",
            "File permissions set to 755 (rwxr-xr-x) via install -m 755",
            "install -d $(BINDIR) creates directory if it doesn't exist (shared with context-engine)",
            "Installation fails gracefully with permission error message if user lacks write access",
            "Binary is executable immediately after installation",
            "Existing binary is overwritten during reinstall",
            "Post-install message confirms installation path",
            "which loop-runner returns correct path after installation",
            "loop-runner --version runs successfully after installation",
            "Both binaries installed atomically in single install target"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Makefile target: install-loop-runner: bin/loop-runner",
              "Command: install -d $(BINDIR)",
              "Command: install -m 755 bin/loop-runner $(BINDIR)/loop-runner",
              "Add install-loop-runner as dependency of main install target",
              "Echo installation path on success: @echo 'Installed: $(BINDIR)/loop-runner'"
            ],
            "middleware": [
              "Check if $(BINDIR) requires sudo and warn user",
              "Verify binary exists before attempting install"
            ],
            "shared": [
              "Binary name constant: LOOP_BINARY=loop-runner",
              "Source path: bin/$(LOOP_BINARY)"
            ]
          },
          "testable_properties": [],
          "function_id": "Install.loopRunnerBinary",
          "related_concepts": [
            "file permissions",
            "install command",
            "binary installation",
            "companion binary",
            "PATH configuration"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_004.5",
          "description": "Support user-local installation to ~/.local/bin without sudo by allowing PREFIX override and providing shell configuration guidance",
          "type": "sub_process",
          "parent_id": "REQ_004",
          "children": [],
          "acceptance_criteria": [
            "PREFIX=~/.local make install installs to ~/.local/bin without sudo",
            "PREFIX=$HOME/.local make install works (expanded path)",
            "Installation creates ~/.local/bin if it doesn't exist",
            "Post-install message includes PATH configuration instructions",
            "Instructions provided for bash (~/.bashrc) and zsh (~/.zshrc)",
            "Instructions show: export PATH=\"$HOME/.local/bin:$PATH\"",
            "make install-user target provided as shortcut for PREFIX=~/.local make install",
            "User installation doesn't conflict with system installation",
            "Both binaries installed to same user-local directory",
            "Documentation includes troubleshooting for PATH not configured"
          ],
          "implementation": {
            "frontend": [],
            "backend": [
              "Ensure PREFIX ?= /usr/local allows override via environment or command line",
              "Add Makefile target: install-user: ; PREFIX=$$HOME/.local $(MAKE) install",
              "Add post-install message with PATH instructions for user-local install",
              "Detect if installing to ~/.local and customize message accordingly",
              "Add shell detection (SHELL variable) to provide appropriate rc file"
            ],
            "middleware": [
              "Verify ~/.local/bin doesn't require sudo (user-writable)",
              "Check if ~/.local/bin is already in PATH and skip instructions if so"
            ],
            "shared": [
              "Define USER_PREFIX = $(HOME)/.local constant",
              "Create install.sh wrapper script as alternative to make install-user",
              "Document both Makefile and script-based installation in README"
            ]
          },
          "testable_properties": [],
          "function_id": "Install.userLocalSupport",
          "related_concepts": [
            "XDG Base Directory",
            "user-local installation",
            "PATH configuration",
            "shell rc files",
            "sudo-less installation"
          ],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    },
    {
      "id": "REQ_005",
      "description": "The system must port the planning pipeline module with all 18 core files including 7-step pipeline, requirement decomposition, and property-based test generation",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_005.1",
          "description": "Port models.py RequirementNode and RequirementHierarchy data structures with JSON tags",
          "type": "sub_process",
          "parent_id": "REQ_005",
          "children": [],
          "acceptance_criteria": [],
          "implementation": null,
          "testable_properties": [],
          "function_id": "Data.port",
          "related_concepts": [],
          "category": "functional"
        },
        {
          "id": "REQ_005.2",
          "description": "Port steps.py with 7 pipeline step implementations",
          "type": "sub_process",
          "parent_id": "REQ_005",
          "children": [],
          "acceptance_criteria": [],
          "implementation": null,
          "testable_properties": [],
          "function_id": "Service.port",
          "related_concepts": [],
          "category": "functional"
        },
        {
          "id": "REQ_005.3",
          "description": "Port pipeline.py PlanningPipeline orchestrator (14-303 lines)",
          "type": "sub_process",
          "parent_id": "REQ_005",
          "children": [],
          "acceptance_criteria": [],
          "implementation": null,
          "testable_properties": [],
          "function_id": "Service.port",
          "related_concepts": [],
          "category": "functional"
        },
        {
          "id": "REQ_005.4",
          "description": "Port decomposition.py for requirement decomposition via Claude SDK",
          "type": "sub_process",
          "parent_id": "REQ_005",
          "children": [],
          "acceptance_criteria": [],
          "implementation": null,
          "testable_properties": [],
          "function_id": "Service.port",
          "related_concepts": [],
          "category": "functional"
        },
        {
          "id": "REQ_005.5",
          "description": "Port claude_runner.py Claude SDK wrapper with streaming support",
          "type": "sub_process",
          "parent_id": "REQ_005",
          "children": [],
          "acceptance_criteria": [],
          "implementation": null,
          "testable_properties": [],
          "function_id": "Service.port",
          "related_concepts": [],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    },
    {
      "id": "REQ_006",
      "description": "The system must implement Go data structures matching Python dataclass schemas with proper JSON serialization and validation methods",
      "type": "parent",
      "parent_id": null,
      "children": [
        {
          "id": "REQ_006.1",
          "description": "Implement RequirementNode struct with all fields matching the Python dataclass schema, including proper JSON tags and nested struct references for hierarchical requirement management",
          "type": "sub_process",
          "parent_id": "REQ_006",
          "children": [],
          "acceptance_criteria": [
            "Struct contains id field as string with json tag 'id'",
            "Struct contains description field as string with json tag 'description'",
            "Struct contains type field as string with json tag 'type' (values: 'parent', 'sub_process', 'implementation')",
            "Struct contains parent_id field as *string with json tag 'parent_id,omitempty'",
            "Struct contains children field as []RequirementNode with json tag 'children'",
            "Struct contains acceptance_criteria field as []string with json tag 'acceptance_criteria'",
            "Struct contains implementation field as *ImplementationComponents with json tag 'implementation,omitempty'",
            "Struct contains testable_properties field as []TestableProperty with json tag 'testable_properties'",
            "Struct contains function_id field as *string with json tag 'function_id,omitempty'",
            "Struct contains related_concepts field as []string with json tag 'related_concepts'",
            "Struct contains category field as string with json tag 'category'",
            "Struct correctly serializes to JSON matching Python output format",
            "Struct correctly deserializes from JSON matching Python input format",
            "Children slice is initialized to empty slice (not nil) for consistent JSON output",
            "Unit tests verify round-trip JSON serialization/deserialization",
            "Unit tests verify nested RequirementNode children serialization"
          ],
          "implementation": {
            "frontend": [],
            "backend": [],
            "middleware": [],
            "shared": [
              "Define RequirementNode struct in internal/models/requirement.go",
              "Define ImplementationComponents struct for implementation field",
              "Define TestableProperty struct for testable_properties field",
              "Implement NewRequirementNode constructor function initializing empty slices",
              "Add json struct tags for all fields with proper omitempty for optional fields",
              "Implement MarshalJSON if custom serialization needed",
              "Implement UnmarshalJSON if custom deserialization needed"
            ]
          },
          "testable_properties": [],
          "function_id": "models.RequirementNode",
          "related_concepts": [
            "RequirementHierarchy",
            "ImplementationComponents",
            "TestableProperty",
            "JSON serialization",
            "Go struct tags"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_006.2",
          "description": "Implement Feature struct with all fields for feature tracking including status flags, dependencies, and complexity metadata with proper JSON serialization",
          "type": "sub_process",
          "parent_id": "REQ_006",
          "children": [],
          "acceptance_criteria": [
            "Struct contains id field as string with json tag 'id'",
            "Struct contains name field as string with json tag 'name'",
            "Struct contains description field as string with json tag 'description'",
            "Struct contains priority field as int with json tag 'priority,omitempty'",
            "Struct contains category field as string with json tag 'category,omitempty'",
            "Struct contains passes field as bool with json tag 'passes'",
            "Struct contains blocked field as bool with json tag 'blocked,omitempty'",
            "Struct contains blocked_reason field as string with json tag 'blocked_reason,omitempty'",
            "Struct contains blocked_by field as []string with json tag 'blocked_by,omitempty'",
            "Struct contains dependencies field as []string with json tag 'dependencies,omitempty'",
            "Struct contains tests field as []string with json tag 'tests,omitempty'",
            "Struct contains complexity field as string with json tag 'complexity,omitempty'",
            "Struct contains needs_review field as bool with json tag 'needs_review,omitempty'",
            "Feature with passes=false and blocked=false serializes correctly",
            "Feature with all optional fields empty omits them from JSON output",
            "Unit tests verify JSON output matches Python feature_list.json format",
            "Unit tests verify deserialization from existing Python-generated feature files"
          ],
          "implementation": {
            "frontend": [],
            "backend": [],
            "middleware": [],
            "shared": [
              "Define Feature struct in internal/models/feature.go",
              "Implement NewFeature constructor function with required fields",
              "Add json struct tags for all fields with proper omitempty for optional fields",
              "Define complexity constants (e.g., 'low', 'medium', 'high', 'critical')",
              "Implement IsBlocked helper method checking blocked flag and blocked_by",
              "Implement HasDependencies helper method",
              "Implement GetUnmetDependencies method taking completed feature IDs"
            ]
          },
          "testable_properties": [],
          "function_id": "models.Feature",
          "related_concepts": [
            "FeatureList",
            "dependency tracking",
            "topological sort",
            "complexity detection",
            "feature validation"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_006.3",
          "description": "Implement FeatureList struct containing Features array with methods for feature lookup, filtering, and dependency resolution",
          "type": "sub_process",
          "parent_id": "REQ_006",
          "children": [],
          "acceptance_criteria": [
            "Struct contains Features field as []Feature with json tag 'features'",
            "FeatureList serializes to JSON with 'features' as root array key",
            "FeatureList deserializes from JSON matching Python feature_list.json format",
            "Empty FeatureList serializes as {\"features\": []} not null",
            "Unit tests verify loading existing Python-generated feature_list.json files",
            "Unit tests verify saving and reloading produces identical output",
            "Struct supports direct iteration over Features slice"
          ],
          "implementation": {
            "frontend": [],
            "backend": [],
            "middleware": [],
            "shared": [
              "Define FeatureList struct in internal/models/feature.go",
              "Implement NewFeatureList constructor initializing empty Features slice",
              "Implement LoadFromFile(path string) (*FeatureList, error) function",
              "Implement SaveToFile(path string) error method",
              "Implement FindByID(id string) *Feature method",
              "Implement FindByCategory(category string) []Feature method",
              "Implement GetPendingFeatures() []Feature method (passes=false, blocked=false)",
              "Implement GetBlockedFeatures() []Feature method",
              "Implement GetCompletedFeatures() []Feature method (passes=true)",
              "Implement TopologicalSort() ([]Feature, error) for dependency ordering",
              "Implement AddFeature(f Feature) method",
              "Implement UpdateFeature(f Feature) error method"
            ]
          },
          "testable_properties": [],
          "function_id": "models.FeatureList",
          "related_concepts": [
            "Feature",
            "topological sort",
            "dependency graph",
            "feature filtering",
            "batch operations"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_006.4",
          "description": "Implement Validate() method for RequirementNode performing post-init validation matching Python dataclass __post_init__ logic including type validation and ID format checking",
          "type": "sub_process",
          "parent_id": "REQ_006",
          "children": [],
          "acceptance_criteria": [
            "Validate() returns error if type is not one of 'parent', 'sub_process', 'implementation'",
            "Validate() returns error if id is empty string",
            "Validate() returns error if id does not match REQ_XXX(.Y.Z) format pattern",
            "Validate() returns error if description is empty string",
            "Validate() recursively validates all children RequirementNodes",
            "Validate() returns nil for valid RequirementNode with all required fields",
            "Validate() aggregates multiple validation errors into single error message",
            "Validate() checks parent_id references valid parent when present",
            "Unit tests verify each validation rule independently",
            "Unit tests verify recursive child validation",
            "Unit tests verify error messages are descriptive and actionable",
            "Validation follows Go error wrapping conventions (fmt.Errorf with %w)"
          ],
          "implementation": {
            "frontend": [],
            "backend": [],
            "middleware": [],
            "shared": [
              "Implement Validate() error method on RequirementNode struct",
              "Define validTypes slice containing allowed type values",
              "Define reqIDPattern regex for REQ_XXX(.Y.Z) format validation",
              "Implement validateType() helper checking type field",
              "Implement validateID() helper checking id format with regex",
              "Implement validateChildren() helper for recursive validation",
              "Use errors.Join or custom multi-error for aggregating validation errors",
              "Add context to errors indicating which field and node failed validation"
            ]
          },
          "testable_properties": [],
          "function_id": "models.RequirementNode.Validate",
          "related_concepts": [
            "validation",
            "error handling",
            "ID format REQ_XXX",
            "type enumeration",
            "recursive validation"
          ],
          "category": "functional"
        },
        {
          "id": "REQ_006.5",
          "description": "Implement Validate() method for Feature performing validation of required fields, status consistency, and dependency references",
          "type": "sub_process",
          "parent_id": "REQ_006",
          "children": [],
          "acceptance_criteria": [
            "Validate() returns error if id is empty string",
            "Validate() returns error if name is empty string",
            "Validate() returns error if blocked=true but blocked_reason is empty",
            "Validate() returns error if blocked=true but blocked_by is empty",
            "Validate() returns error if complexity is non-empty and not valid value",
            "Validate() returns error if passes=true and blocked=true simultaneously",
            "Validate() warns if dependencies contains self-reference (feature depends on itself)",
            "Validate() returns nil for valid Feature with all required fields",
            "ValidateWithFeatureList(list *FeatureList) validates dependency IDs exist",
            "Unit tests verify each validation rule independently",
            "Unit tests verify status consistency checks",
            "Unit tests verify complexity value validation"
          ],
          "implementation": {
            "frontend": [],
            "backend": [],
            "middleware": [],
            "shared": [
              "Implement Validate() error method on Feature struct",
              "Implement ValidateWithFeatureList(list *FeatureList) error method",
              "Define validComplexities slice containing allowed complexity values",
              "Implement validateRequired() helper for id and name checks",
              "Implement validateBlockedConsistency() helper for blocked state validation",
              "Implement validateStatusConsistency() helper for passes/blocked conflict",
              "Implement validateDependencies() helper checking for self-references",
              "Implement validateDependencyExists() checking IDs exist in FeatureList"
            ]
          },
          "testable_properties": [],
          "function_id": "models.Feature.Validate",
          "related_concepts": [
            "validation",
            "error handling",
            "status consistency",
            "dependency validation",
            "complexity values"
          ],
          "category": "functional"
        }
      ],
      "acceptance_criteria": [],
      "implementation": null,
      "testable_properties": [],
      "function_id": null,
      "related_concepts": [],
      "category": "functional"
    }
  ],
  "metadata": {
    "source": "agent_sdk_decomposition",
    "research_length": 32637,
    "decomposition_stats": {
      "requirements_found": 7,
      "subprocesses_expanded": 35,
      "total_nodes": 42,
      "extraction_time_ms": 30117,
      "expansion_time_ms": 553044
    }
  }
}