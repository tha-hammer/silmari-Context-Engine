# BAML Integration TDD Implementation - Overview

## Goal
Integrate BAML (Boundary AI Markup Language) into the Context Engine to replace regex-based output parsing with type-safe, schema-driven LLM function calls.

## Approach
**Hybrid Architecture**: Keep Claude CLI subprocess for execution, use BAML for structured parsing of text output.

## Implementation Phases

| Phase | Name | Testable Function | Dependencies |
|-------|------|-------------------|--------------|
| [Phase 1](./01-phase-1-project-setup.md) | Project Setup | `baml-cli --version` succeeds | None |
| [Phase 2](./02-phase-2-schema-definitions.md) | Schema Definitions | `ResearchOutput`, `PlanOutput`, `Phase` models instantiable | Phase 1 |
| [Phase 3](./03-phase-3-parsing-functions.md) | Parsing Functions | `ParseResearchOutput()`, `ParsePlanOutput()`, `ParsePhaseFiles()` callable | Phase 2 |
| [Phase 4](./04-phase-4-helper-integration.md) | Helper Integration | `parse_research_output()` in `baml_helpers.py` | Phase 3 |
| [Phase 5](./05-phase-5-steps-integration.md) | Steps Integration | `step_research()` returns `ResearchStepResult` dataclass | Phase 4 |
| [Phase 6](./06-phase-6-error-handling.md) | Error Handling | `parse_research_output_safe()` with graceful failures | Phase 5 |
| [Phase 7](./07-phase-7-pipeline-integration.md) | Pipeline Integration | `BAMLPlanningPipeline.run()` returns `PipelineResult` | Phase 6 |

## Project Structure After Implementation

```
silmari-Context-Engine/
├── pyproject.toml                    # Python deps with baml-py
├── baml_src/                         # BAML source definitions
│   ├── main.baml                     # Generator config
│   ├── clients.baml                  # LLM client definitions
│   ├── schemas.baml                  # ResearchOutput, PlanOutput, etc.
│   └── functions.baml                # ParseResearchOutput, etc.
├── baml_client/                      # GENERATED: Python client
│   └── (auto-generated by baml-cli)
├── planning_pipeline/
│   ├── baml_helpers.py               # BAML parsing wrappers
│   ├── baml_steps.py                 # Steps with typed returns
│   ├── baml_pipeline.py              # Pipeline with typed results
│   └── tests/
│       ├── test_baml_setup.py        # Phase 1
│       ├── test_baml_schemas.py      # Phase 2
│       ├── test_baml_functions.py    # Phase 3
│       ├── test_baml_helpers.py      # Phase 4
│       ├── test_baml_steps.py        # Phase 5
│       ├── test_baml_errors.py       # Phase 6
│       └── test_baml_pipeline.py     # Phase 7
```

## Success Criteria

All phases complete when:
- [ ] `pytest planning_pipeline/tests/test_baml_*.py -v` all pass
- [ ] IDE autocomplete works for all BAML-generated types
- [ ] Type checker validates all pipeline code
- [ ] Full pipeline returns typed `PipelineResult` instead of `dict[str, Any]`

## References

- Research: `thoughts/shared/research/2026-01-01-baml-integration-research.md`
- Full TDD Plan: `thoughts/shared/plans/2026-01-01-tdd-baml-integration.md`
- BAML Documentation: https://docs.boundaryml.com/home
